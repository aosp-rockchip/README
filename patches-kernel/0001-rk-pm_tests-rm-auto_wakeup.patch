From f865ee1dd8c12ab05b04ba27ee3d96b61504057d Mon Sep 17 00:00:00 2001
From: xxx <xxx@rock-chips.com>
Date: Wed, 24 Apr 2013 18:42:49 +0800
Subject: [PATCH] rk: pm_tests: rm auto_wakeup

---
 arch/arm/plat-rk/rk_pm_tests/auto_wakeup.c | 97 ----------------------
 arch/arm/plat-rk/rk_pm_tests/auto_wakeup.h | 10 ---
 2 files changed, 107 deletions(-)
 delete mode 100644 arch/arm/plat-rk/rk_pm_tests/auto_wakeup.c
 delete mode 100644 arch/arm/plat-rk/rk_pm_tests/auto_wakeup.h

diff --git a/arch/arm/plat-rk/rk_pm_tests/auto_wakeup.c b/arch/arm/plat-rk/rk_pm_tests/auto_wakeup.c
deleted file mode 100644
index 067dd52541c9..000000000000
--- a/arch/arm/plat-rk/rk_pm_tests/auto_wakeup.c
+++ /dev/null
@@ -1,97 +0,0 @@
-#include <linux/android_alarm.h>
-#include <linux/mutex.h>
-#include <linux/kobject.h>
-#include <linux/string.h>
-
-#include "rk_pm_tests.h"
-#include "auto_wakeup.h"
-static struct alarm alarm;
-static struct timespec period;
-static int alarm_status = 0;
-static DEFINE_MUTEX(mutex);
-
-static int get_alarm_status(void)
-{
-	return alarm_status;
-}
-
-static void alarm_update(struct alarm *alarm)
-{
-	struct timespec now_time;
-	struct timespec new_time;
-
-	now_time = ktime_to_timespec(alarm_get_elapsed_realtime());
-
-	PM_DBG("now_time %ld\n",now_time.tv_sec);
-
-	new_time.tv_sec = now_time.tv_sec + period.tv_sec;
-	new_time.tv_nsec = now_time.tv_nsec + period.tv_nsec;
-
-	alarm_start_range(alarm, timespec_to_ktime(new_time), timespec_to_ktime(new_time));
-}
-
-static void stop_auto_wakeup(void)
-{
-	mutex_lock(&mutex);
-
-	if(alarm_status) {
-		alarm_cancel(&alarm);
-		alarm_status = 0;
-	}
-
-	mutex_unlock(&mutex);
-}
-
-static void start_auto_wakeup(long second)
-{
-	stop_auto_wakeup();
-
-	mutex_lock(&mutex);
-
-	period.tv_sec = second;
-	period.tv_nsec = 0;
-
-	alarm_init(&alarm, ANDROID_ALARM_ELAPSED_REALTIME_WAKEUP, alarm_update);	
-	alarm_update(&alarm);
-	alarm_status = 1;
-
-	mutex_unlock(&mutex);
-}
-
-ssize_t auto_wakeup_show(struct kobject *kobj, struct kobj_attribute *attr,
-		char *buf)
-{
-	char *s = buf;
-
-	if(get_alarm_status())
-		s += sprintf(s, "%s\n", "on");
-	else
-		s += sprintf(s, "%s\n", "off");
-
-	return (s - buf);
-}
-
-ssize_t auto_wakeup_store(struct kobject *kobj, struct kobj_attribute *attr,
-		const char *buf, size_t n)
-{
-	char cmd[10];
-	long val;
-	int len;
-	int error = -EINVAL;
-
-	sscanf(buf, "%s %ld", cmd, &val);
-	len = strlen(cmd);
-
-	if (len == strlen("on") && !strncmp(cmd,"on",len)) {
-		start_auto_wakeup(val);
-		error = 0;
-	}
-	else if(len == strlen("off") && !strncmp(cmd,"off",len)) {
-		stop_auto_wakeup();
-		error = 0;
-	}
-
-	return error ? error : n;
-}
-
-
diff --git a/arch/arm/plat-rk/rk_pm_tests/auto_wakeup.h b/arch/arm/plat-rk/rk_pm_tests/auto_wakeup.h
deleted file mode 100644
index 6967730777e6..000000000000
--- a/arch/arm/plat-rk/rk_pm_tests/auto_wakeup.h
+++ /dev/null
@@ -1,10 +0,0 @@
-#ifndef __AUTO_WAKEUP_H 
-#define __AUTO_WAKEUP_H 
-
-ssize_t auto_wakeup_show(struct kobject *kobj, struct kobj_attribute *attr,
-		char *buf);
-ssize_t auto_wakeup_store(struct kobject *kobj, struct kobj_attribute *attr,
-		const char *buf, size_t n);
-
-#endif
-
-- 
2.35.3

