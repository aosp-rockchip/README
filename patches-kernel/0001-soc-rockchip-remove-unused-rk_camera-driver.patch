From c76d3b11d82dd719145c248bcc047b2681d12f24 Mon Sep 17 00:00:00 2001
From: Tao Huang <huangtao@rock-chips.com>
Date: Tue, 12 Nov 2019 19:09:48 +0800
Subject: [PATCH] soc/rockchip: remove unused rk_camera driver

Signed-off-by: Tao Huang <huangtao@rock-chips.com>
Change-Id: I3f5a7b6c2dddaf00d8a598d4836ecb56ce0f03ef
---
 drivers/soc/rockchip/rk_camera.c | 1252 ------------------------------
 drivers/soc/rockchip/rk_camera.h |  354 ---------
 2 files changed, 1606 deletions(-)
 delete mode 100644 drivers/soc/rockchip/rk_camera.c
 delete mode 100644 drivers/soc/rockchip/rk_camera.h

diff --git a/drivers/soc/rockchip/rk_camera.c b/drivers/soc/rockchip/rk_camera.c
deleted file mode 100644
index 95595f1bc774..000000000000
--- a/drivers/soc/rockchip/rk_camera.c
+++ /dev/null
@@ -1,1252 +0,0 @@
-/*
- * drivers/soc/rockchip/rk_camera.c
- *
- * Copyright (C) 2017, ROCKCHIP, Inc.
- *
- * This software is licensed under the terms of the GNU General Public
- * License version 2, as published by the Free Software Foundation, and
- * may be copied, distributed, and modified under those terms.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- */
-
-#include <linux/gpio.h>
-#include <linux/delay.h>
-#include <linux/version.h>
-#include <linux/moduleparam.h>
-#include <linux/of_gpio.h>
-#include <linux/mfd/syscon.h>
-#include <linux/of.h>
-#include <linux/of_irq.h>
-#include <linux/kernel.h>
-#include <linux/of_address.h>
-#include <linux/of_platform.h>
-#include <linux/of_fdt.h>
-#include <linux/module.h>
-#include <linux/regulator/consumer.h>
-#include "rk_camera.h"
-
-static int camio_version = KERNEL_VERSION(0, 1, 9);
-module_param(camio_version, int, S_IRUGO);
-
-static int camera_debug;
-module_param(camera_debug, int, S_IRUGO | S_IWUSR);
-
-#undef  CAMMODULE_NAME
-#define CAMMODULE_NAME		"rk_cam_io"
-
-#define ddprintk(level, fmt, arg...)					\
-	do {								\
-		if (camera_debug >= level)				\
-			printk(KERN_WARNING "%s(%d):" fmt"\n",		\
-			       CAMMODULE_NAME, __LINE__, ## arg);	\
-	} while (0)
-
-#define dprintk(format, ...)					\
-	ddprintk(1, format, ## __VA_ARGS__)
-#define eprintk(format, ...)					\
-	printk(KERN_ERR "%s(%d):" format"\n",			\
-	       CAMMODULE_NAME, __LINE__, ## __VA_ARGS__)
-#define debug_printk(format, ...)				\
-	ddprintk(3, format, ## __VA_ARGS__)
-
-static int rk_sensor_io_init(void);
-static int rk_sensor_io_deinit(int sensor);
-static int rk_sensor_ioctrl(struct device *dev,
-			    enum rk29camera_ioctrl_cmd cmd, int on);
-static int rk_sensor_power(struct device *dev, int on);
-static int rk_sensor_register(void);
-static int rk_dts_sensor_probe(struct platform_device *pdev);
-static int rk_dts_sensor_remove(struct platform_device *pdev);
-static int rk_sensor_powerdown(struct device *dev, int on);
-
-static struct rkcamera_platform_data *new_camera_head;
-
-struct rk29camera_platform_data rk_camera_platform_data = {
-	.io_init = rk_sensor_io_init,
-	.io_deinit = rk_sensor_io_deinit,
-	.sensor_ioctrl = rk_sensor_ioctrl,
-	.sensor_register = rk_sensor_register,
-};
-
-struct rk29camera_platform_ioctl_cb sensor_ioctl_cb = {
-	.sensor_power_cb = NULL,
-	.sensor_reset_cb = NULL,
-	.sensor_powerdown_cb = NULL,
-	.sensor_flash_cb = NULL,
-	.sensor_af_cb = NULL,
-};
-
-static const struct of_device_id of_match_sensor[] = {
-	{.compatible = "rockchip,sensor",},
-	{},
-};
-MODULE_DEVICE_TABLE(of, of_match_sensor);
-static struct platform_driver rk_sensor_driver = {
-	.driver = {
-		.name	= "rk_sensor",
-		.of_match_table = of_match_ptr(of_match_sensor),
-	},
-	.probe		= rk_dts_sensor_probe,
-	.remove		= rk_dts_sensor_remove,
-};
-
-static int rk_dts_sensor_remove(struct platform_device *pdev)
-{
-	return 0;
-}
-
-struct rk29_camera_gpio camera_gpios;
-static struct gpio_desc *rk_dts_sensor_parse_gpio(
-	struct device *dev,
-	struct fwnode_handle *child,
-	int pltfrm_gpio,
-	const char *label)
-{
-	struct rk29_camera_gpio *camera_gpio;
-	struct rk29_camera_gpio *new_gpio;
-	struct gpio_desc *gpio;
-
-	if (IS_ERR_VALUE(pltfrm_gpio))
-		return NULL;
-
-	list_for_each_entry(camera_gpio, &camera_gpios.gpios, gpios) {
-		if (camera_gpio->pltfrm_gpio == pltfrm_gpio)
-			break;
-	}
-
-	if (camera_gpio->pltfrm_gpio != pltfrm_gpio) {
-		dprintk("%s(%d): alloc a new gpio for pltfrm gpio %d\n",
-			__func__, __LINE__, pltfrm_gpio);
-		new_gpio = kzalloc(sizeof(*new_gpio), GFP_KERNEL);
-		if (!new_gpio) {
-			eprintk("%s(%d): alloc camera_gpio failed\n",
-				__func__, __LINE__);
-			return NULL;
-		}
-
-		new_gpio->pltfrm_gpio = pltfrm_gpio;
-		new_gpio->count = 1;
-		new_gpio->gpio_desc =
-			devm_get_gpiod_from_child(dev, label, child);
-		if (IS_ERR(new_gpio->gpio_desc)) {
-			eprintk("gpio reset get failed.\n");
-			goto err_alloc;
-		}
-
-		list_add_tail(&new_gpio->gpios, &camera_gpios.gpios);
-		gpio = new_gpio->gpio_desc;
-	} else {
-		camera_gpio->count++;
-		gpio = camera_gpio->gpio_desc;
-		dprintk("%s(%d): gpio %d have get count %d\n",
-			__func__, __LINE__,
-			pltfrm_gpio, camera_gpio->count);
-	}
-
-	return gpio;
-err_alloc:
-	kfree(new_gpio);
-
-	return NULL;
-}
-
-static int rk_dts_sensor_probe(struct platform_device *pdev)
-{
-	struct device_node *np, *cp;
-	int sensor_num = 0, err;
-	struct device *dev = &pdev->dev;
-	struct rkcamera_platform_data *new_camera_list;
-	struct fwnode_handle *child;
-	enum of_gpio_flags flags;
-	int power = INVALID_GPIO;
-	int powerdown = INVALID_GPIO;
-	int reset = INVALID_GPIO;
-	int af = INVALID_GPIO;
-	int flash = INVALID_GPIO;
-	int irq = INVALID_GPIO;
-	int count;
-
-	np = dev->of_node;
-	if (!np)
-		return -ENODEV;
-
-	count = device_get_child_node_count(dev);
-	if (!count)
-		return -ENODEV;
-
-	INIT_LIST_HEAD(&camera_gpios.gpios);
-	device_for_each_child_node(dev, child) {
-		u32 flash_attach = 0, mir = 0, i2c_chl = 0, i2c_add = 0;
-		u32 cif_chl = 0, mclk_rate = 0, is_front = 0;
-		u32 resolution = 0, powerup_sequence = 0;
-		int pwr_active = 0, rst_active = 0, pwdn_active = 0;
-		int flash_active = 0;
-		int orientation = 0;
-
-		char sensor_name[20] = {0};
-		char *name = NULL;
-		const char *status = NULL;
-
-		struct rkcamera_platform_data *new_camera;
-
-		cp = to_of_node(child);
-
-		of_property_read_string(cp, "status", &status);
-		if (status && !strcmp(status, "disabled"))
-			continue;
-
-		strcpy(sensor_name, cp->name);
-		name = sensor_name;
-		if (strstr(sensor_name, "_") != NULL)
-			name = strsep(&name, "_");
-
-		new_camera = kzalloc(sizeof(struct rkcamera_platform_data),
-				     GFP_KERNEL);
-		if (!new_camera)
-			return -ENOMEM;
-
-		if (!sensor_num) {
-			new_camera_head = new_camera;
-			rk_camera_platform_data.register_dev_new = new_camera_head;
-			new_camera_list = new_camera;
-		}
-		sensor_num++;
-		new_camera_list->next_camera = new_camera;
-		new_camera_list = new_camera;
-
-		if (of_property_read_u32(cp, "flash_attach", &flash_attach))
-			dprintk("%s:Get %s rockchip,flash_attach failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "mir", &mir))
-			dprintk("%s:Get %s rockchip,mir failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "i2c_chl", &i2c_chl))
-			dprintk("%s:Get %s rockchip,i2c_chl failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "cif_chl", &cif_chl))
-			dprintk("%s:Get %s rockchip,cif_chl failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "mclk_rate", &mclk_rate))
-			dprintk("%s:Get %s rockchip,mclk_rate failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "is_front", &is_front))
-			dprintk("%s:Get %s rockchip,is_front failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "pwdn_active", &pwdn_active))
-			dprintk("%s:Get %s pwdn_active failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "pwr_active", &pwr_active))
-			dprintk("%s:Get %s pwr_active failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "rst_active", &rst_active))
-			dprintk("%s:Get %s rst_active failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "flash_active", &flash_active))
-			dprintk("%s:Get %s flash_active failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "i2c_add", &i2c_add))
-			dprintk("%s:Get %s rockchip,i2c_add failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "resolution", &resolution))
-			dprintk("%s:Get %s rockchip,resolution failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "powerup_sequence",
-					 &powerup_sequence))
-			dprintk("%s:Get %s rockchip,powerup_sequence failed!\n",
-				__func__, cp->name);
-
-		if (of_property_read_u32(cp, "orientation", &orientation))
-			dprintk("%s:Get %s rockchip,orientation failed!\n",
-				__func__, cp->name);
-
-		of_property_read_u32_array(
-			cp,
-			"rockchip,camera-module-defrect0",
-			(unsigned int *)&new_camera->defrects[0],
-			6);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-interface0",
-			&new_camera->defrects[0].interface);
-		of_property_read_u32_array(
-			cp,
-			"rockchip,camera-module-defrect1",
-			(unsigned int *)&new_camera->defrects[1],
-			6);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-interface1",
-			&new_camera->defrects[1].interface);
-		of_property_read_u32_array(
-			cp,
-			"rockchip,camera-module-defrect2",
-			(unsigned int *)&new_camera->defrects[2],
-			6);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-interface2",
-			&new_camera->defrects[2].interface);
-		of_property_read_u32_array(
-			cp,
-			"rockchip,camera-module-defrect3",
-			(unsigned int *)&new_camera->defrects[3],
-			6);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-interface3",
-			&new_camera->defrects[3].interface);
-		of_property_read_u32_array(
-			cp,
-			"rockchip,camera-module-channel",
-			(unsigned int *)&new_camera->channel_info,
-			2);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-ain-1",
-			&new_camera->channel_info.channel_info[0]);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-ain-2",
-			&new_camera->channel_info.channel_info[1]);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-ain-3",
-			&new_camera->channel_info.channel_info[2]);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-ain-4",
-			&new_camera->channel_info.channel_info[3]);
-		of_property_read_string(
-			cp,
-			"rockchip,camera-module-ain-5",
-			&new_camera->channel_info.channel_info[4]);
-
-		strcpy(new_camera->dev.i2c_cam_info.type, name);
-		new_camera->dev.i2c_cam_info.addr = i2c_add >> 1;
-		new_camera->dev.desc_info.host_desc.bus_id = RK29_CAM_PLATFORM_DEV_ID + cif_chl;
-		new_camera->dev.desc_info.host_desc.i2c_adapter_id = i2c_chl;
-		new_camera->dev.desc_info.host_desc.module_name = name;
-		new_camera->dev.device_info.name = "soc-camera-pdrv";
-		if (is_front)
-			sprintf(new_camera->dev_name, "%s_%s", name, "front");
-		else
-			sprintf(new_camera->dev_name, "%s_%s", name, "back");
-		new_camera->dev.device_info.dev.init_name = (const char *)&new_camera->dev_name[0];
-
-		power = of_get_named_gpio_flags(cp, "power-gpios",
-						0, &flags);
-		powerdown = of_get_named_gpio_flags(cp, "powerdown-gpios",
-						    0, &flags);
-		reset = of_get_named_gpio_flags(cp, "reset-gpios",
-						0, &flags);
-		af = of_get_named_gpio_flags(cp, "af-gpios",
-					     0, &flags);
-		flash = of_get_named_gpio_flags(cp, "flash-gpios",
-						0, &flags);
-		irq = of_get_named_gpio_flags(cp, "irq-gpios",
-					      0, &flags);
-
-		new_camera->io.gpio_reset =
-			rk_dts_sensor_parse_gpio(dev, child, reset, "reset");
-
-		new_camera->io.gpio_power =
-			rk_dts_sensor_parse_gpio(dev, child, power, "power");
-
-		new_camera->io.gpio_powerdown =
-			rk_dts_sensor_parse_gpio(dev, child,
-						 powerdown, "powerdown");
-
-		new_camera->io.gpio_af =
-			rk_dts_sensor_parse_gpio(dev, child, af, "af");
-
-		new_camera->io.gpio_flash =
-			rk_dts_sensor_parse_gpio(dev, child, flash, "flash");
-
-		new_camera->io.gpio_irq =
-			rk_dts_sensor_parse_gpio(dev, child, irq, "irq");
-
-		new_camera->io.reset = reset;
-		new_camera->io.power = power;
-		new_camera->io.powerdown = powerdown;
-		new_camera->io.af = af;
-		new_camera->io.flash = flash;
-		new_camera->io.irq = irq;
-		new_camera->io.gpio_flag = ((pwr_active & 0x01) << RK29_CAM_POWERACTIVE_BITPOS) |
-					    ((rst_active & 0x01) << RK29_CAM_RESETACTIVE_BITPOS) |
-					    ((pwdn_active & 0x01) << RK29_CAM_POWERDNACTIVE_BITPOS) |
-					    ((flash_active & 0x01) << RK29_CAM_FLASHACTIVE_BITPOS);
-		new_camera->orientation = orientation;
-		new_camera->resolution = resolution;
-		new_camera->mirror = mir;
-		new_camera->flash = flash_attach;
-		new_camera->pwdn_info = ((pwdn_active & 0x10) | 0x01);
-		new_camera->if_powerdown = true;
-		new_camera->powerup_sequence = powerup_sequence;
-		new_camera->mclk_rate = mclk_rate;
-		new_camera->of_node = cp;
-
-		new_camera->powerdown_pmu_name = NULL;
-		new_camera->power_pmu_name1 = NULL;
-		new_camera->power_pmu_name2 = NULL;
-		new_camera->powerdown_pmu_voltage = 0;
-		new_camera->power_pmu_name1 = 0;
-		new_camera->power_pmu_name2 = 0;
-
-		err = of_property_read_string(cp, "rockchip,powerdown_pmu", &(new_camera->powerdown_pmu_name));
-		if(err < 0)
-			dprintk("Get rockchip,powerdown_pmu failed\n");
-
-		err = of_property_read_string(cp,"rockchip,power_pmu_name1", &(new_camera->power_pmu_name1));
-		if(err < 0)
-			dprintk("Get rockchip,power_pmu_name1 failed\n");
-
-		err = of_property_read_string(cp,"rockchip,power_pmu_name2", &(new_camera->power_pmu_name2));
-		if(err < 0)
-			dprintk("rockchip,power_pmu_name2 failed\n");
-
-		if (of_property_read_u32(cp, "rockchip,powerdown_pmu_voltage", &(new_camera->powerdown_pmu_voltage)))
-			dprintk("%s:Get %s rockchip,powerdown_pmu_voltage failed!\n", __func__, cp->name);
-
-		if (of_property_read_u32(cp, "rockchip,power_pmu_voltage1", &(new_camera->power_pmu_voltage1)))
-			dprintk("%s:Get %s rockchip,power_pmu_voltage1 failed!\n", __func__, cp->name);
-
-		if (of_property_read_u32(cp, "rockchip,power_pmu_voltage2", &(new_camera->power_pmu_voltage2)))
-			dprintk("%s:Get %s rockchip,power_pmu_voltage2 failed!\n", __func__,  cp->name);
-
-		debug_printk("******************* /n i2c_add = %x\n", new_camera->dev.i2c_cam_info.addr << 1);
-		debug_printk("******************* /n i2c_chl = %d\n", new_camera->dev.desc_info.host_desc.i2c_adapter_id);
-		debug_printk("******************* /n init_name = %s\n", new_camera->dev.device_info.dev.init_name);
-		debug_printk("******************* /n dev_name = %s\n", new_camera->dev_name);
-		debug_printk("******************* /n module_name = %s\n", new_camera->dev.desc_info.host_desc.module_name);
-	}
-	new_camera_list->next_camera = NULL;
-
-	return 0;
-}
-
-static int sensor_power_default_cb (struct rk29camera_gpio_res *res, int on)
-{
-	struct gpio_desc *camera_power = res->gpio_power;
-	int camera_ioflag = res->gpio_flag;
-	int camera_io_init = res->gpio_init;
-	int ret = 0;
-
-	struct regulator *ldo_18,*ldo_28;
-	struct rkcamera_platform_data *dev =
-		container_of(res, struct rkcamera_platform_data, io);
-
-	int power_pmu_voltage1 = dev->power_pmu_voltage1;
-	int power_pmu_voltage2 = dev->power_pmu_voltage2;
-	const char *camera_power_pmu_name1 = dev->power_pmu_name1;
-	const char *camera_power_pmu_name2 = dev->power_pmu_name2;;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__,__FUNCTION__);
-
-	if (camera_power_pmu_name1 != NULL) {
-		ldo_28 = regulator_get(NULL, camera_power_pmu_name1); /* vcc18_cif */
-	        if (on) {
-			regulator_set_voltage(ldo_28, power_pmu_voltage1, power_pmu_voltage1);
-			ret = regulator_enable(ldo_28);
-			regulator_put(ldo_28);
-
-			msleep(10);
-		} else {
-			if (regulator_is_enabled(ldo_28) > 0)
-				regulator_disable(ldo_28);
-			regulator_put(ldo_28);
-		}
-	}
-
-	if(camera_power_pmu_name2 != NULL) {
-		ldo_18 = regulator_get(NULL, camera_power_pmu_name2); /* vcc18_cif */
-        if (on) {
-			regulator_set_voltage(ldo_18, power_pmu_voltage2, power_pmu_voltage2);
-			//regulator_set_suspend_voltage(ldo, 1800000);
-			ret = regulator_enable(ldo_18);
-			regulator_put(ldo_18);
-
-			msleep(10);
-		} else {
-			if (regulator_is_enabled(ldo_18) > 0)
-				regulator_disable(ldo_18);
-			regulator_put(ldo_18);
-		}
-	}
-
-	if (camera_power) {
-		if (camera_io_init & RK29_CAM_POWERACTIVE_MASK) {
-			if (on) {
-				gpiod_set_value(camera_power,
-					       ((camera_ioflag & RK29_CAM_POWERACTIVE_MASK) >>
-						RK29_CAM_POWERACTIVE_BITPOS));
-				dprintk("%s PowerPin ..PinLevel = %x",
-					res->dev_name,
-					((camera_ioflag & RK29_CAM_POWERACTIVE_MASK) >>
-					 RK29_CAM_POWERACTIVE_BITPOS));
-				msleep(10);
-			} else {
-				gpiod_set_value(camera_power,
-					       (((~camera_ioflag) & RK29_CAM_POWERACTIVE_MASK) >>
-						RK29_CAM_POWERACTIVE_BITPOS));
-				dprintk("%s PowerPin ..PinLevel = %x",
-					res->dev_name,
-					(((~camera_ioflag) & RK29_CAM_POWERACTIVE_MASK) >>
-					 RK29_CAM_POWERACTIVE_BITPOS));
-			}
-		} else {
-			ret = RK29_CAM_EIO_REQUESTFAIL;
-			eprintk("%s PowerPin request failed!", res->dev_name);
-		}
-	} else {
-		ret = RK29_CAM_EIO_INVALID;
-	}
-
-	return ret;
-}
-
-static int sensor_reset_default_cb (struct rk29camera_gpio_res *res, int on)
-{
-	struct gpio_desc *camera_reset = res->gpio_reset;
-	int camera_ioflag = res->gpio_flag;
-	int camera_io_init = res->gpio_init;
-	int ret = 0;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__, __FUNCTION__);
-
-	if (camera_reset) {
-		if (camera_io_init & RK29_CAM_RESETACTIVE_MASK) {
-			if (on) {
-				gpiod_set_value(camera_reset,
-					       ((camera_ioflag & RK29_CAM_RESETACTIVE_MASK) >>
-						RK29_CAM_RESETACTIVE_BITPOS));
-				dprintk("%s ResetPin ..PinLevel = %x",
-					res->dev_name,
-					((camera_ioflag & RK29_CAM_RESETACTIVE_MASK) >>
-					 RK29_CAM_RESETACTIVE_BITPOS));
-			} else {
-				gpiod_set_value(camera_reset,
-					       (((~camera_ioflag) & RK29_CAM_RESETACTIVE_MASK) >>
-						RK29_CAM_RESETACTIVE_BITPOS));
-				dprintk("%s ResetPin ..PinLevel = %x",
-					res->dev_name,
-					(((~camera_ioflag) & RK29_CAM_RESETACTIVE_MASK) >>
-					 RK29_CAM_RESETACTIVE_BITPOS));
-			}
-		} else {
-			ret = RK29_CAM_EIO_REQUESTFAIL;
-			dprintk("%s ResetPin request failed!",
-				res->dev_name);
-		}
-	} else {
-		ret = RK29_CAM_EIO_INVALID;
-	}
-
-	return ret;
-}
-
-static int sensor_powerdown_default_cb (struct rk29camera_gpio_res *res, int on)
-{
-	struct gpio_desc *camera_powerdown = res->gpio_powerdown;
-	int camera_ioflag = res->gpio_flag;
-	int camera_io_init = res->gpio_init;
-	int ret = 0;
-
-	struct regulator *powerdown_pmu;
-	struct rkcamera_platform_data *dev =
-		container_of(res, struct rkcamera_platform_data, io);
-	int powerdown_pmu_voltage = dev->powerdown_pmu_voltage;
-	const char *powerdown_pmu_name = dev->powerdown_pmu_name;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__, __FUNCTION__);
-
-	if (powerdown_pmu_name != NULL) {
-		powerdown_pmu = regulator_get(NULL, powerdown_pmu_name);
-		if (on) {
-			regulator_set_voltage(powerdown_pmu, powerdown_pmu_voltage, powerdown_pmu_voltage);
-			ret = regulator_enable(powerdown_pmu);
-			regulator_put(powerdown_pmu);
-		} else {
-			if (regulator_is_enabled(powerdown_pmu) > 0)
-				regulator_disable(powerdown_pmu);
-			regulator_put(powerdown_pmu);
-		}
-	}
-
-	if (camera_powerdown) {
-		if (camera_io_init & RK29_CAM_POWERDNACTIVE_MASK) {
-			if (on) {
-				gpiod_set_value(camera_powerdown,
-					       ((camera_ioflag & RK29_CAM_POWERDNACTIVE_MASK) >>
-						RK29_CAM_POWERDNACTIVE_BITPOS));
-				dprintk("%s PowerDownPin ..PinLevel = %x",
-					res->dev_name,
-					((camera_ioflag & RK29_CAM_POWERDNACTIVE_MASK) >>
-					 RK29_CAM_POWERDNACTIVE_BITPOS));
-			} else {
-				gpiod_set_value(camera_powerdown,
-					       (((~camera_ioflag) & RK29_CAM_POWERDNACTIVE_MASK) >>
-						RK29_CAM_POWERDNACTIVE_BITPOS));
-				dprintk("%s PowerDownPin ..PinLevel = %x",
-					res->dev_name,
-					(((~camera_ioflag) & RK29_CAM_POWERDNACTIVE_MASK) >>
-					 RK29_CAM_POWERDNACTIVE_BITPOS));
-			}
-		} else {
-			ret = RK29_CAM_EIO_REQUESTFAIL;
-			dprintk("%s PowerDownPin request failed!",
-				res->dev_name);
-		}
-	}else {
-		ret = RK29_CAM_EIO_INVALID;
-	}
-
-	return ret;
-}
-
-
-static int sensor_flash_default_cb (struct rk29camera_gpio_res *res, int on)
-{
-	struct gpio_desc *camera_flash = res->gpio_flash;
-	int camera_ioflag = res->gpio_flag;
-	int camera_io_init = res->gpio_init;
-	int ret = 0;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()/n", __FILE__, __LINE__,__FUNCTION__);
-
-	if (camera_flash) {
-		if (camera_io_init & RK29_CAM_FLASHACTIVE_MASK) {
-			switch (on)
-			{
-				case Flash_Off:
-				{
-					gpiod_set_value(camera_flash,
-						       (((~camera_ioflag) & RK29_CAM_FLASHACTIVE_MASK) >>
-							RK29_CAM_FLASHACTIVE_BITPOS));
-					dprintk("%s FlashPin ..PinLevel = %x",
-						res->dev_name,
-						(((~camera_ioflag) & RK29_CAM_FLASHACTIVE_MASK) >>
-						 RK29_CAM_FLASHACTIVE_BITPOS));
-					break;
-				}
-
-				case Flash_On:
-				{
-					gpiod_set_value(camera_flash,
-						       ((camera_ioflag & RK29_CAM_FLASHACTIVE_MASK) >>
-							RK29_CAM_FLASHACTIVE_BITPOS));
-					dprintk("%s FlashPin ..PinLevel = %x",
-						res->dev_name,
-						((camera_ioflag & RK29_CAM_FLASHACTIVE_MASK) >>
-						 RK29_CAM_FLASHACTIVE_BITPOS));
-					break;
-				}
-
-				case Flash_Torch:
-				{
-					gpiod_set_value(camera_flash,
-						       ((camera_ioflag & RK29_CAM_FLASHACTIVE_MASK) >>
-							RK29_CAM_FLASHACTIVE_BITPOS));
-					dprintk("%s FlashPin ..PinLevel = %x",
-						res->dev_name,
-						((camera_ioflag & RK29_CAM_FLASHACTIVE_MASK) >>
-						 RK29_CAM_FLASHACTIVE_BITPOS));
-					break;
-				}
-
-				default:
-				{
-					eprintk("%s Flash command(%d) is invalidate",
-						res->dev_name, on);
-					break;
-				}
-			}
-		} else {
-			ret = RK29_CAM_EIO_REQUESTFAIL;
-			eprintk("%s FlashPin request failed!",
-				res->dev_name);
-		}
-	} else {
-		ret = RK29_CAM_EIO_INVALID;
-	}
-
-	return ret;
-}
-
-static int sensor_afpower_default_cb (struct rk29camera_gpio_res *res, int on)
-{
-	struct gpio_desc *camera_af = res->gpio_af;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()/n", __FILE__, __LINE__, __FUNCTION__);
-
-	if (camera_af) {
-		gpiod_set_value(camera_af, on);
-	}
-
-	return 0;
-}
-
-static int _rk_sensor_io_init_(struct rkcamera_platform_data *new_camera)
-{
-	int ret = 0;
-	struct rk29camera_gpio_res *gpio_res = &new_camera->io;
-	struct gpio_desc *camera_reset;
-	struct gpio_desc *camera_power;
-	struct gpio_desc *camera_powerdown;
-	struct gpio_desc *camera_flash;
-	struct gpio_desc *camera_af;
-	unsigned int camera_ioflag;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__, __FUNCTION__);
-
-	camera_reset = gpio_res->gpio_reset;
-	camera_power = gpio_res->gpio_power;
-	camera_powerdown = gpio_res->gpio_powerdown;
-	camera_flash = gpio_res->gpio_flash;
-	camera_af = gpio_res->gpio_af;
-	camera_ioflag = gpio_res->gpio_flag;
-	gpio_res->gpio_init = 0;
-
-	if (camera_power) {
-		gpio_res->gpio_init |= RK29_CAM_POWERACTIVE_MASK;
-		gpiod_set_value(camera_power,
-			       (((~camera_ioflag) & RK29_CAM_POWERACTIVE_MASK) >>
-				 RK29_CAM_POWERACTIVE_BITPOS));
-		gpiod_direction_output(camera_power,
-				      (((~camera_ioflag) & RK29_CAM_POWERACTIVE_MASK) >>
-					RK29_CAM_POWERACTIVE_BITPOS));
-
-		dprintk("%s power pin init success(0x%x)",
-			gpio_res->dev_name,
-			(((~camera_ioflag) & RK29_CAM_POWERACTIVE_MASK) >>
-			 RK29_CAM_POWERACTIVE_BITPOS));
-	}
-
-	if (camera_reset) {
-		gpio_res->gpio_init |= RK29_CAM_RESETACTIVE_MASK;
-		gpiod_set_value(camera_reset,
-			       ((camera_ioflag & RK29_CAM_RESETACTIVE_MASK) >>
-				RK29_CAM_RESETACTIVE_BITPOS));
-		gpiod_direction_output(camera_reset,
-				      ((camera_ioflag & RK29_CAM_RESETACTIVE_MASK) >>
-				       RK29_CAM_RESETACTIVE_BITPOS));
-
-		dprintk("%s reset pin init success(0x%x)",
-			gpio_res->dev_name,
-			((camera_ioflag&RK29_CAM_RESETACTIVE_MASK)>>RK29_CAM_RESETACTIVE_BITPOS));
-	}
-
-	if (camera_powerdown) {
-		debug_printk("gpio_res->dev_name: %s", gpio_res->dev_name);
-		if (strstr(gpio_res->dev_name, "tp2825") || strstr(gpio_res->dev_name, "adv7181")) {
-			debug_printk("don't control powerdown!\n");
-			new_camera->if_powerdown = false;
-		}
-
-		gpio_res->gpio_init |= RK29_CAM_POWERDNACTIVE_MASK;
-		gpiod_set_value(camera_powerdown, ((camera_ioflag & RK29_CAM_POWERDNACTIVE_MASK) >> RK29_CAM_POWERDNACTIVE_BITPOS));
-		gpiod_direction_output(camera_powerdown, ((camera_ioflag & RK29_CAM_POWERDNACTIVE_MASK) >> RK29_CAM_POWERDNACTIVE_BITPOS));
-
-		if (!new_camera->if_powerdown) {
-			gpiod_set_value(camera_powerdown, ((camera_ioflag & RK29_CAM_POWERDNACTIVE_MASK) >> RK29_CAM_POWERDNACTIVE_BITPOS));
-			msleep(50);
-			gpiod_set_value(camera_powerdown, ((~camera_ioflag & RK29_CAM_POWERDNACTIVE_MASK) >> RK29_CAM_POWERDNACTIVE_BITPOS));
-		}
-
-		dprintk("%s powerdown pin init success(0x%x)",
-			gpio_res->dev_name,
-			((camera_ioflag & RK29_CAM_POWERDNACTIVE_MASK) >> RK29_CAM_POWERDNACTIVE_BITPOS));
-	}
-
-	if (camera_flash) {
-		gpio_res->gpio_init |= RK29_CAM_FLASHACTIVE_MASK;
-		gpiod_set_value(camera_flash, ((~camera_ioflag&RK29_CAM_FLASHACTIVE_MASK)>>RK29_CAM_FLASHACTIVE_BITPOS));   //  falsh off
-		gpiod_direction_output(camera_flash, ((~camera_ioflag&RK29_CAM_FLASHACTIVE_MASK)>>RK29_CAM_FLASHACTIVE_BITPOS));
-
-		dprintk("%s flash pin init success(0x%x)",
-			gpio_res->dev_name,
-			((camera_ioflag & RK29_CAM_FLASHACTIVE_MASK) >> RK29_CAM_FLASHACTIVE_BITPOS));
-	}
-
-	if (camera_af) {
-		gpio_res->gpio_init |= RK29_CAM_AFACTIVE_MASK;
-		//gpio_direction_output(camera_af, ((camera_ioflag&RK29_CAM_AFACTIVE_MASK)>>RK29_CAM_AFACTIVE_BITPOS));
-		dprintk("%s af pin init success",gpio_res->dev_name);
-	}
-
-	return ret;
-}
-
-static int _rk_sensor_io_deinit_(struct rk29camera_gpio_res *gpio_res)
-{
-	struct gpio_desc *camera_reset;
-	struct gpio_desc *camera_power;
-	struct gpio_desc *camera_powerdown;
-	struct gpio_desc *camera_flash;
-	struct gpio_desc *camera_af;
-
-	debug_printk("/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()/n",
-		     __FILE__, __LINE__, __FUNCTION__);
-
-	camera_reset = gpio_res->gpio_reset;
-	camera_power = gpio_res->gpio_power;
-	camera_powerdown = gpio_res->gpio_powerdown;
-	camera_flash = gpio_res->gpio_flash;
-	camera_af = gpio_res->gpio_af;
-
-	if (gpio_res->gpio_init & RK29_CAM_POWERACTIVE_MASK) {
-		if (camera_power) {
-			gpiod_direction_input(camera_power);
-			gpiod_put(camera_power);
-		}
-	}
-
-	if (gpio_res->gpio_init & RK29_CAM_RESETACTIVE_MASK) {
-		if (camera_reset) {
-			gpiod_direction_input(camera_reset);
-			gpiod_put(camera_reset);
-		}
-	}
-
-	if (gpio_res->gpio_init & RK29_CAM_POWERDNACTIVE_MASK) {
-		if (camera_powerdown) {
-			gpiod_direction_input(camera_powerdown);
-			gpiod_put(camera_powerdown);
-		}
-	}
-
-	if (gpio_res->gpio_init & RK29_CAM_FLASHACTIVE_MASK) {
-		if (camera_flash) {
-			gpiod_direction_input(camera_flash);
-			gpiod_put(camera_flash);
-		}
-	}
-
-	if (gpio_res->gpio_init & RK29_CAM_AFACTIVE_MASK) {
-		if (camera_af) {
-			/* gpiod_direction_input(camera_af);*/
-			gpiod_put(camera_af);
-		}
-	}
-	gpio_res->gpio_init = 0;
-
-	return 0;
-}
-
-static int rk_sensor_io_init(void)
-{
-	static bool is_init = false;
-
-	struct rkcamera_platform_data *new_camera;
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__, __FUNCTION__);
-
-	if (is_init)
-		return 0;
-	else
-		is_init = true;
-
-	if (sensor_ioctl_cb.sensor_power_cb == NULL)
-		sensor_ioctl_cb.sensor_power_cb = sensor_power_default_cb;
-	if (sensor_ioctl_cb.sensor_reset_cb == NULL)
-		sensor_ioctl_cb.sensor_reset_cb = sensor_reset_default_cb;
-	if (sensor_ioctl_cb.sensor_powerdown_cb == NULL)
-		sensor_ioctl_cb.sensor_powerdown_cb = sensor_powerdown_default_cb;
-	if (sensor_ioctl_cb.sensor_flash_cb == NULL)
-		sensor_ioctl_cb.sensor_flash_cb = sensor_flash_default_cb;
-	if (sensor_ioctl_cb.sensor_af_cb == NULL)
-		sensor_ioctl_cb.sensor_af_cb = sensor_afpower_default_cb;
-
-	new_camera = new_camera_head;
-	while(new_camera != NULL)
-	{
-		if (_rk_sensor_io_init_(new_camera) < 0)
-			_rk_sensor_io_deinit_(&new_camera->io);
-		new_camera = new_camera->next_camera;
-	}
-	return 0;
-}
-
-static int rk_sensor_io_deinit(int sensor)
-{
-	struct rkcamera_platform_data *new_camera;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()/n", __FILE__, __LINE__,__FUNCTION__);
-
-	new_camera = new_camera_head;
-	while(new_camera != NULL)
-	{
-		_rk_sensor_io_deinit_(&new_camera->io);
-		new_camera = new_camera->next_camera;
-	}
-
-	return 0;
-}
-static int rk_sensor_ioctrl(struct device *dev,enum rk29camera_ioctrl_cmd cmd, int on)
-{
-	struct rk29camera_gpio_res *res = NULL;
-	struct rkcamera_platform_data *new_cam_dev = NULL;
-	struct rk29camera_platform_data* plat_data = &rk_camera_platform_data;
-	int ret = RK29_CAM_IO_SUCCESS, i = 0;
-	struct soc_camera_desc *dev_icl = NULL;
-	struct rkcamera_platform_data *new_camera;
-	debug_printk("/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()/n", __FILE__, __LINE__, __FUNCTION__);
-
-	if (res == NULL) {
-		new_camera = new_camera_head;
-		while(new_camera != NULL) {
-			if (strcmp(new_camera->dev_name, dev_name(dev)) == 0) {
-				res = (struct rk29camera_gpio_res *)&new_camera->io;
-				new_cam_dev = &new_camera[i];
-				dev_icl = &new_camera->dev.desc_info;
-				break;
-			}
-			new_camera = new_camera->next_camera;
-		}
-	}
-
-	if (res == NULL) {
-		eprintk("%s is not regisiterd in rk29_camera_platform_data!!",dev_name(dev));
-		ret = RK29_CAM_EIO_INVALID;
-		goto rk_sensor_ioctrl_end;
-	}
-
-	switch (cmd)
-	{
-		case Cam_Power:
-		{
-			if (sensor_ioctl_cb.sensor_power_cb) {
-				ret = sensor_ioctl_cb.sensor_power_cb(res, on);
-				ret = (ret != RK29_CAM_EIO_INVALID)?ret:0;     /* ddl@rock-chips.com: v0.1.1 */
-			} else {
-				eprintk("sensor_ioctl_cb.sensor_power_cb is NULL");
-				WARN_ON(1);
-			}
-
-			break;
-		}
-
-		case Cam_Reset:
-		{
-			if (sensor_ioctl_cb.sensor_reset_cb) {
-				ret = sensor_ioctl_cb.sensor_reset_cb(res, on);
-
-				ret = (ret != RK29_CAM_EIO_INVALID) ? ret : 0;
-			} else {
-				eprintk( "sensor_ioctl_cb.sensor_reset_cb is NULL");
-				WARN_ON(1);
-			}
-			break;
-		}
-
-		case Cam_PowerDown:
-		{
-			if (sensor_ioctl_cb.sensor_powerdown_cb) {
-				if (new_camera->if_powerdown)
-					ret = sensor_ioctl_cb.sensor_powerdown_cb(res, on);
-			} else {
-				eprintk("sensor_ioctl_cb.sensor_powerdown_cb is NULL");
-				WARN_ON(1);
-			}
-			break;
-		}
-
-		case Cam_Flash:
-		{
-			if (sensor_ioctl_cb.sensor_flash_cb) {
-				ret = sensor_ioctl_cb.sensor_flash_cb(res, on);
-			} else {
-				eprintk( "sensor_ioctl_cb.sensor_flash_cb is NULL!");
-				WARN_ON(1);
-			}
-			break;
-		}
-
-		case Cam_Af:
-		{
-			if (sensor_ioctl_cb.sensor_af_cb) {
-				ret = sensor_ioctl_cb.sensor_af_cb(res, on);
-			} else {
-				eprintk( "sensor_ioctl_cb.sensor_af_cb is NULL!");
-				WARN_ON(1);
-			}
-			break;
-		}
-
-		case Cam_Mclk:
-		{
-			if (plat_data->sensor_mclk && dev_icl) {
-				plat_data->sensor_mclk(dev_icl->host_desc.bus_id,(on!=0)?1:0,on);
-			} else {
-				eprintk("%s(%d): sensor_mclk(%p) or dev_icl(%p) is NULL",
-					__FUNCTION__,__LINE__,plat_data->sensor_mclk,dev_icl);
-			}
-			break;
-		}
-
-		default:
-		{
-			eprintk("%s cmd(0x%x) is unknown!", __FUNCTION__, cmd);
-			break;
-		}
-	}
-
-rk_sensor_ioctrl_end:
-	return ret;
-}
-
-static int rk_sensor_pwrseq(struct device *dev,int powerup_sequence, int on, int mclk_rate)
-{
-	int ret =0;
-	int i, powerup_type;
-
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__,__FUNCTION__);
-
-	for (i = 0; i < SENSOR_PWRSEQ_CNT; i++) {
-
-		if (on == 1)
-			powerup_type = SENSOR_PWRSEQ_GET(powerup_sequence, i);
-		else
-			powerup_type = SENSOR_PWRSEQ_GET(powerup_sequence, SENSOR_PWRSEQ_CNT - 1 - i);
-
-		switch (powerup_type)
-		{
-			case SENSOR_PWRSEQ_AVDD:
-			case SENSOR_PWRSEQ_DOVDD:
-			case SENSOR_PWRSEQ_DVDD:
-			case SENSOR_PWRSEQ_PWR:
-			{
-				ret = rk_sensor_ioctrl(dev, Cam_Power, on);
-				if (ret < 0) {
-					eprintk("SENSOR_PWRSEQ_PWR failed");
-				} else {
-					msleep(10);
-					dprintk("SensorPwrSeq-power: %d", on);
-				}
-				break;
-			}
-
-			case SENSOR_PWRSEQ_HWRST:
-			{
-				if (!on) {
-					rk_sensor_ioctrl(dev, Cam_Reset, 1);
-				} else {
-					ret = rk_sensor_ioctrl(dev, Cam_Reset, 1);
-					msleep(2);
-					ret |= rk_sensor_ioctrl(dev, Cam_Reset, 0);
-				}
-				if (ret < 0) {
-					eprintk("SENSOR_PWRSEQ_HWRST failed");
-				} else {
-					dprintk("SensorPwrSeq-reset: %d", on);
-				}
-				break;
-			}
-
-			case SENSOR_PWRSEQ_PWRDN:
-			{
-				ret = rk_sensor_ioctrl(dev, Cam_PowerDown, !on);
-				if (ret < 0) {
-					eprintk("SENSOR_PWRSEQ_PWRDN failed");
-				} else {
-					dprintk("SensorPwrSeq-power down: %d", !on);
-				}
-				break;
-			}
-
-			case SENSOR_PWRSEQ_CLKIN:
-			{
-				ret = rk_sensor_ioctrl(dev, Cam_Mclk, (on ? mclk_rate : on));
-				if (ret<0) {
-					eprintk("SENSOR_PWRSEQ_CLKIN failed");
-				} else {
-					dprintk("SensorPwrSeq-clock: %d", on);
-				}
-				break;
-			}
-
-			default:
-				break;
-		}
-	}
-
-	return ret;
-}
-
-static int rk_sensor_power(struct device *dev, int on)
-{
-	int powerup_sequence,mclk_rate;
-
-	struct rk29camera_platform_data* plat_data = &rk_camera_platform_data;
-	struct rk29camera_gpio_res *dev_io = NULL;
-	struct rkcamera_platform_data *new_camera=NULL, *new_device=NULL;
-	bool real_pwroff = true;
-	int ret = 0;
-
-	debug_printk("/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__, __FUNCTION__);
-
-	new_camera = plat_data->register_dev_new;
-
-	while (new_camera != NULL) {
-		if (new_camera->io.gpio_powerdown && new_camera->if_powerdown) {
-			gpiod_direction_output(new_camera->io.gpio_powerdown,
-				((new_camera->io.gpio_flag&RK29_CAM_POWERDNACTIVE_MASK)>>RK29_CAM_POWERDNACTIVE_BITPOS));
-		}
-		debug_printk("new_camera->dev_name= %s \n", new_camera->dev_name);
-		debug_printk("dev_name(dev)= %s \n", dev_name(dev));
-		if (strcmp(new_camera->dev_name,dev_name(dev))) {
-			debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i\n", __FILE__, __LINE__);
-			if (sensor_ioctl_cb.sensor_powerdown_cb && on)
-			{
-				debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i\n", __FILE__, __LINE__);
-				sensor_ioctl_cb.sensor_powerdown_cb(&new_camera->io,1);
-			}
-		} else {
-			new_device = new_camera;
-			dev_io = &new_camera->io;
-			debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i\n", __FILE__, __LINE__);
-			if (!Sensor_Support_DirectResume(new_camera->pwdn_info))
-				real_pwroff = true;
-			else
-				real_pwroff = false;
-		}
-		new_camera = new_camera->next_camera;
-	}
-
-	if (new_device != NULL) {
-		powerup_sequence = new_device->powerup_sequence;
-		if ((new_device->mclk_rate == 24) || (new_device->mclk_rate == 48))
-			mclk_rate = new_device->mclk_rate*1000000;
-		else
-			mclk_rate = 24000000;
-	} else {
-		powerup_sequence = sensor_PWRSEQ_DEFAULT;
-		mclk_rate = 24000000;
-	}
-
-	if (on) {
-		debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i\n", __FILE__, __LINE__);
-		rk_sensor_pwrseq(dev, powerup_sequence, on,mclk_rate);
-	} else {
-		if (real_pwroff) {
-			if (rk_sensor_pwrseq(dev, powerup_sequence, on, mclk_rate) < 0)		/* ddl@rock-chips.com: v0.1.5 */
-				goto PowerDown;
-
-			/*ddl@rock-chips.com: all power down switch to Hi-Z after power off*/
-			new_camera = plat_data->register_dev_new;
-			while (new_camera != NULL) {
-				if ((new_camera->io.gpio_powerdown) && new_camera->if_powerdown) {
-					gpiod_direction_input(new_camera->io.gpio_powerdown);
-				}
-				new_camera->pwdn_info |= 0x01;
-				new_camera = new_camera->next_camera;
-			}
-		} else {
-PowerDown:
-			rk_sensor_ioctrl(dev, Cam_PowerDown, !on);
-
-			rk_sensor_ioctrl(dev, Cam_Mclk, 0);
-		}
-
-		mdelay(10);/* ddl@rock-chips.com: v0.1.3 */
-	}
-	return ret;
-}
-
-#if 0
-static int rk_sensor_reset(struct device *dev)
-{
-#if 0
-	rk_sensor_ioctrl(dev,Cam_Reset,1);
-	msleep(2);
-	rk_sensor_ioctrl(dev,Cam_Reset,0);
-#else
-    /*
-    *ddl@rock-chips.com : the rest function invalidate, because this operate is put together in rk_sensor_power;
-    */
-#endif
-	return 0;
-}
-#endif
-
-static int rk_sensor_powerdown(struct device *dev, int on)
-{
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()/n", __FILE__, __LINE__,__FUNCTION__);
-
-	return rk_sensor_ioctrl(dev,Cam_PowerDown,on);
-}
-
-int rk_sensor_register(void)
-{
-	int i;
-	struct rkcamera_platform_data *new_camera;
-
-	i = 0;
-	debug_printk( "/$$$$$$$$$$$$$$$$$$$$$$//n Here I am: %s:%i-------%s()\n", __FILE__, __LINE__, __FUNCTION__);
-
-	new_camera = new_camera_head;
-
-	while (new_camera != NULL) {
-		if (new_camera->dev.i2c_cam_info.addr == INVALID_VALUE) {
-			WARN(1, KERN_ERR "%s(%d): new_camera[%d] i2c addr is invalidate!",
-				__FUNCTION__,__LINE__,i);
-			continue;
-		}
-		sprintf(new_camera->dev_name,"%s_%d",new_camera->dev.device_info.dev.init_name,i+3);
-		new_camera->dev.device_info.dev.init_name =(const char*)&new_camera->dev_name[0];
-		new_camera->io.dev_name =(const char*)&new_camera->dev_name[0];
-		if (new_camera->orientation == INVALID_VALUE) {
-			if (strstr(new_camera->dev_name,  "back")) {
-				new_camera->orientation = 90;
-			} else {
-				new_camera->orientation = 270;
-			}
-		}
-		/* ddl@rock-chips.com: v0.1.3 */
-		if ((new_camera->fov_h <= 0) || (new_camera->fov_h>360))
-			new_camera->fov_h = 100;
-
-		if ((new_camera->fov_v <= 0) || (new_camera->fov_v>360))
-			new_camera->fov_v = 100;
-
-		new_camera->dev.desc_info.subdev_desc.power = rk_sensor_power;
-		new_camera->dev.desc_info.subdev_desc.powerdown = rk_sensor_powerdown;
-		new_camera->dev.desc_info.host_desc.board_info =&new_camera->dev.i2c_cam_info;
-
-		new_camera->dev.device_info.id = i+6;
-		new_camera->dev.device_info.dev.platform_data = &new_camera->dev.desc_info;
-		new_camera->dev.desc_info.subdev_desc.drv_priv = &rk_camera_platform_data;
-
-		platform_device_register(&(new_camera->dev.device_info));
-		i++;
-		new_camera = new_camera->next_camera;
-	}
-
-	return 0;
-}
-
-static int rk_register_camera_devices(void)
-{
-	platform_driver_register(&rk_sensor_driver);
-
-	if (rk_camera_platform_data.sensor_register)
-		rk_camera_platform_data.sensor_register();
-
-	return 0;
-}
-
-module_init(rk_register_camera_devices);
diff --git a/drivers/soc/rockchip/rk_camera.h b/drivers/soc/rockchip/rk_camera.h
deleted file mode 100644
index 293342efe1e0..000000000000
--- a/drivers/soc/rockchip/rk_camera.h
+++ /dev/null
@@ -1,354 +0,0 @@
-/*
- * camera.h - PXA camera driver header file
- *
- * Copyright (C) 2003, Intel Corporation
- * Copyright (C) 2008, Guennadi Liakhovetski <kernel@pengutronix.de>
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- */
-
-#ifndef _RK_CAMERA_H
-#define _RK_CAMERA_H
-
-#include <linux/videodev2.h>
-#include <media/soc_camera.h>
-#include <linux/i2c.h>
-#include <linux/platform_device.h>
-#include <linux/v4l2-mediabus.h>
-#include "rk_camera_sensor_info.h"
-#include <dt-bindings/pinctrl/rockchip-rk3288.h>
-
-#define RK29_CAM_PLATFORM_DEV_ID 33
-#define RK_CAM_PLATFORM_DEV_ID_0 RK29_CAM_PLATFORM_DEV_ID
-#define RK_CAM_PLATFORM_DEV_ID_1 (RK_CAM_PLATFORM_DEV_ID_0+1)
-#define INVALID_VALUE -1
-#ifndef INVALID_GPIO
-#define INVALID_GPIO INVALID_VALUE
-#endif
-#define RK29_CAM_IO_SUCCESS 0
-#define RK29_CAM_EIO_INVALID -3
-#define RK29_CAM_EIO_REQUESTFAIL -2
-
-#define RK29_CAM_POWERACTIVE_BITPOS	0x00
-#define RK29_CAM_RESETACTIVE_BITPOS	0x01
-#define RK29_CAM_POWERDNACTIVE_BITPOS 0x02
-#define RK29_CAM_FLASHACTIVE_BITPOS	0x03
-#define RK29_CAM_AFACTIVE_BITPOS	0x04
-
-#define RK_CAM_SUPPORT_RESOLUTION 0x800000
-
-#define _CONS(a,b) a##b
-#define CONS(a,b) _CONS(a,b)
-
-#define _CONS4(a,b,c,d) a##b##c##d
-#define CONS4(a,b,c,d) _CONS4(a,b,c,d)
-
-#define __STR(x) #x
-#define _STR(x) __STR(x)
-#define STR(x) _STR(x)
-
-/*---------------- Camera Sensor Must Define Macro Begin  ------------------------*/
-/*
- * move to rk_camera_sensor_info.h   yzm
- */
-/*---------------- Camera Sensor Must Define Macro End  ------------------------*/
-
-
-//#define RK29_CAM_POWERACTIVE_BITPOS	0x00
-#define RK29_CAM_POWERACTIVE_MASK	(1<<RK29_CAM_POWERACTIVE_BITPOS)
-#define RK29_CAM_POWERACTIVE_H	(0x01<<RK29_CAM_POWERACTIVE_BITPOS)
-#define RK29_CAM_POWERACTIVE_L	(0x00<<RK29_CAM_POWERACTIVE_BITPOS)
-
-//#define RK29_CAM_RESETACTIVE_BITPOS	0x01
-#define RK29_CAM_RESETACTIVE_MASK	(1<<RK29_CAM_RESETACTIVE_BITPOS)
-#define RK29_CAM_RESETACTIVE_H	(0x01<<RK29_CAM_RESETACTIVE_BITPOS)
-#define RK29_CAM_RESETACTIVE_L  (0x00<<RK29_CAM_RESETACTIVE_BITPOS)
-
-//#define RK29_CAM_POWERDNACTIVE_BITPOS	0x02
-#define RK29_CAM_POWERDNACTIVE_MASK	(1<<RK29_CAM_POWERDNACTIVE_BITPOS)
-#define RK29_CAM_POWERDNACTIVE_H	(0x01<<RK29_CAM_POWERDNACTIVE_BITPOS)
-#define RK29_CAM_POWERDNACTIVE_L	(0x00<<RK29_CAM_POWERDNACTIVE_BITPOS)
-
-//#define RK29_CAM_FLASHACTIVE_BITPOS	0x03
-#define RK29_CAM_FLASHACTIVE_MASK	(1<<RK29_CAM_FLASHACTIVE_BITPOS)
-#define RK29_CAM_FLASHACTIVE_H	(0x01<<RK29_CAM_FLASHACTIVE_BITPOS)
-#define RK29_CAM_FLASHACTIVE_L  (0x00<<RK29_CAM_FLASHACTIVE_BITPOS)
-
-
-//#define RK29_CAM_AFACTIVE_BITPOS	0x04
-#define RK29_CAM_AFACTIVE_MASK	(1<<RK29_CAM_AFACTIVE_BITPOS)
-#define RK29_CAM_AFACTIVE_H	(0x01<<RK29_CAM_AFACTIVE_BITPOS)
-#define RK29_CAM_AFACTIVE_L  (0x00<<RK29_CAM_AFACTIVE_BITPOS)
-
-
-
-#define RK_CAM_SCALE_CROP_ARM      0
-#define RK_CAM_SCALE_CROP_IPP      1
-#define RK_CAM_SCALE_CROP_RGA      2
-#define RK_CAM_SCALE_CROP_PP       3
-
-#define RK_CAM_INPUT_FMT_YUV422    (1<<0)
-#define RK_CAM_INPUT_FMT_RAW10     (1<<1)
-#define RK_CAM_INPUT_FMT_RAW12     (1<<2)
-
-#define RK_CAM_INPUT_VIDEO_STATE_LOSS	0x01
-#define RK_CAM_INPUT_VIDEO_STATE_LOCKED	0x00		//default video state value is 0x00
-
-/* v4l2_subdev_core_ops.ioctl  ioctl_cmd macro */
-#define RK29_CAM_SUBDEV_ACTIVATE            0x00
-#define RK29_CAM_SUBDEV_DEACTIVATE          0x01
-#define RK29_CAM_SUBDEV_IOREQUEST			0x02
-#define RK29_CAM_SUBDEV_CB_REGISTER         0x03
-#define RK29_CAM_SUBDEV_GET_INTERFACE		0x04
-#define RK29_CAM_SUBDEV_GET_VIDEO_STATE		0x05
-
-#define Sensor_HasBeen_PwrOff(a)            (a&0x01)
-#define Sensor_Support_DirectResume(a)      ((a&0x10)==0x10)
-
-#define Sensor_CropSet(a,b)                  a->reserved[1] = b;
-#define Sensor_CropGet(a)                    a->reserved[1]
-
-#define RK29_CAM_SUBDEV_HDR_EXPOSURE        0x04
-
-#define RK_VIDEOBUF_HDR_EXPOSURE_MINUS_1        0x00
-#define RK_VIDEOBUF_HDR_EXPOSURE_NORMAL         0x01
-#define RK_VIDEOBUF_HDR_EXPOSURE_PLUS_1         0x02
-#define RK_VIDEOBUF_HDR_EXPOSURE_FINISH         0x03
-#define RK_VIDEOBUF_CODE_SET(rk_code,type)  rk_code = (('R'<<24)|('K'<<16)|type)
-#define RK_VIDEOBUF_CODE_CHK(rk_code)       ((rk_code&(('R'<<24)|('K'<<16)))==(('R'<<24)|('K'<<16)))
-
-#define CONFIG_CAMERA_INPUT_FMT_SUPPORT     (RK_CAM_INPUT_FMT_YUV422)
-#ifdef CONFIG_SOC_RK3028
-#define CONFIG_CAMERA_SCALE_CROP_MACHINE    RK_CAM_SCALE_CROP_ARM
-#else
-#define CONFIG_CAMERA_SCALE_CROP_MACHINE    RK_CAM_SCALE_CROP_IPP
-#endif
-#if (CONFIG_CAMERA_SCALE_CROP_MACHINE == RK_CAM_SCALE_CROP_ARM)
-    #define CAMERA_SCALE_CROP_MACHINE  "arm"
-#elif (CONFIG_CAMERA_SCALE_CROP_MACHINE == RK_CAM_SCALE_CROP_IPP)
-    #define CAMERA_SCALE_CROP_MACHINE  "ipp"
-#elif (CONFIG_CAMERA_SCALE_CROP_MACHINE == RK_CAM_SCALE_CROP_RGA)
-    #define CAMERA_SCALE_CROP_MACHINE  "rga"
-#elif (CONFIG_CAMERA_SCALE_CROP_MACHINE == RK_CAM_SCALE_CROP_PP)
-    #define CAMERA_SCALE_CROP_MACHINE  "pp"
-#endif
-
-#define RK29_CAM_DRV_NAME "rk312x-camera"
-#define CAMERA_VIDEOBUF_ARM_ACCESS   0
-
-enum rk29camera_ioctrl_cmd
-{
-	Cam_Power,
-	Cam_Reset,
-	Cam_PowerDown,
-	Cam_Flash,
-	Cam_Mclk,
-	Cam_Af
-};
-
-enum rk29sensor_power_cmd
-{
-    Sensor_Power,
-	Sensor_Reset,
-	Sensor_PowerDown,
-	Sensor_Flash,
-	Sensor_Af
-};
-
-enum rk29camera_flash_cmd
-{
-    Flash_Off,
-    Flash_On,
-    Flash_Torch
-};
-
-struct rk29_camera_gpio {
-	struct gpio_desc *gpio_desc;
-	unsigned int pltfrm_gpio;
-	int count;
-
-	struct list_head gpios;
-};
-
-struct rk29camera_gpio_res {
-	struct gpio_desc *gpio_reset;
-	struct gpio_desc *gpio_power;
-	struct gpio_desc *gpio_powerdown;
-	struct gpio_desc *gpio_flash;
-	struct gpio_desc *gpio_af;
-	struct gpio_desc *gpio_irq;
-	int reset;
-	int power;
-	int powerdown;
-	int flash;
-	int af;
-	int irq;
-	unsigned int gpio_flag;
-	unsigned int gpio_init;
-	const char *dev_name;
-};
-
-struct rk29camera_mem_res {
-	const char *name;
-	unsigned int start;
-	unsigned int size;
-    void __iomem *vbase;  //指向IO空间的指针，为了驱动程序的通用性考虑
-};
-struct rk29camera_info {
-    const char *dev_name;
-    unsigned int orientation;
-    struct v4l2_frmivalenum fival[10];
-};
-
-struct reginfo_t
-{
-	u16 reg;
-	u16 val;
-	u16 reg_len;
-	u16 rev;
-};
-typedef struct rk_sensor_user_init_data{
-	int rk_sensor_init_width;
-	int rk_sensor_init_height;
-	unsigned long rk_sensor_init_bus_param;
-	//enum v4l2_mbus_pixelcode rk_sensor_init_pixelcode;
-	struct reginfo_t * rk_sensor_init_data;
-	int rk_sensor_winseq_size;
-	struct reginfo_t * rk_sensor_init_winseq;
-	int rk_sensor_init_data_size;
-}rk_sensor_user_init_data_s;
-
-typedef struct rk_camera_device_register_info {
-    struct i2c_board_info i2c_cam_info;
-	struct soc_camera_desc desc_info;/*yzm*/
-    struct platform_device device_info;
-}rk_camera_device_register_info_t;
-
-enum rk_camera_signal_polarity {
-	RK_CAMERA_DEVICE_SIGNAL_HIGH_LEVEL = 1,
-	RK_CAMERA_DEVICE_SIGNAL_LOW_LEVEL = 0,
-};
-
-enum rk_camera_device_type {
-	RK_CAMERA_DEVICE_BT601_PIONGPONG	= 0x10000010,
-	RK_CAMERA_DEVICE_BT601_8	= 0x10000011,
-	RK_CAMERA_DEVICE_BT601_10	= 0x10000012,
-	RK_CAMERA_DEVICE_BT601_12	= 0x10000014,
-	RK_CAMERA_DEVICE_BT601_16	= 0x10000018,
-
-	RK_CAMERA_DEVICE_BT656_8	= 0x10000021,
-	RK_CAMERA_DEVICE_BT656_10	= 0x10000022,
-	RK_CAMERA_DEVICE_BT656_12	= 0x10000024,
-	RK_CAMERA_DEVICE_BT656_16	= 0x10000028,
-
-	RK_CAMERA_DEVICE_CVBS_NTSC	= 0x20000001,
-	RK_CAMERA_DEVICE_CVBS_PAL	= 0x20000002,
-	RK_CAMERA_DEVICE_CVBS_DEINTERLACE	= 0x20000003,
-};
-
-struct rk_camera_dvp_config {
-	enum rk_camera_signal_polarity vsync;
-	enum rk_camera_signal_polarity hsync;
-};
-
-struct rk_camera_device_signal_config {
-	enum rk_camera_device_type type;
-	u32 code;
-	struct rk_camera_dvp_config dvp;
-	struct v4l2_rect crop;
-};
-
-struct rk_camera_device_defrect {
-	unsigned int width;
-	unsigned int height;
-	struct v4l2_rect defrect;
-	const char *interface;
-};
-
-struct rk_camera_device_channel_info {
-	unsigned int channel_total;
-	unsigned int default_id;
-	const char *channel_info[5];
-};
-
-struct rkcamera_platform_data {
-    rk_camera_device_register_info_t dev;
-    char dev_name[32];
-    struct rk29camera_gpio_res io;
-    int orientation;
-    int resolution;
-    int mirror;       /* bit0:  0: mirror off
-                                1: mirror on
-                         bit1:  0: flip off
-                                1: flip on
-                      */
-    bool flash;       /* true:  the sensor attached flash;
-                         false: the sensor haven't attach flash;
-
-                      */
-    int pwdn_info;    /* bit4: 1: sensor isn't need to be init after exit stanby, it can streaming directly
-                               0: sensor must be init after exit standby;
-
-                         bit0: 1: sensor power have been turn off;
-                               0: sensor power is always on;
-                      */
-
-    long powerup_sequence;       /*
-                                    bit0-bit3 --- power up sequence first step;
-                                    bit4-bit7 --- power up sequence second step;
-                                     .....
-                                  */
-    int mclk_rate;       /* MHz : 24/48 */
-    int fov_h;           /* fied of view horizontal */
-    int fov_v;           /* fied of view vertical */
-	int if_powerdown;	/* Whether to control powerdown pin when enter/exit camera;
-					true: control; false: don't control;*/
-	const char *power_pmu_name1;
-	const char *power_pmu_name2;
-	const char *powerdown_pmu_name;
-	int power_pmu_voltage1;
-	int power_pmu_voltage2;
-	int powerdown_pmu_voltage;
-	struct device_node *of_node;
-	struct rkcamera_platform_data *next_camera;/*yzm*/
-	struct rk_camera_device_defrect defrects[4];
-	struct rk_camera_device_channel_info channel_info;
-};
-
-struct rk29camera_platform_data {
-    int (*io_init)(void);
-    int (*io_deinit)(int sensor);
-	int (*sensor_ioctrl)(struct device *dev,enum rk29camera_ioctrl_cmd cmd,int on);
-
-    int (*sensor_register)(void);
-    int (*sensor_mclk)(int cif_idx, int on, int clk_rate);
-
-    struct rkcamera_platform_data *register_dev_new;  //sensor
-	struct device *cif_dev;/*yzm host*/
-	const char *rockchip_name;
-	int iommu_enabled;
-};
-
-struct rk29camera_platform_ioctl_cb {
-    int (*sensor_power_cb)(struct rk29camera_gpio_res *res, int on);
-    int (*sensor_reset_cb)(struct rk29camera_gpio_res *res, int on);
-    int (*sensor_powerdown_cb)(struct rk29camera_gpio_res *res, int on);
-    int (*sensor_flash_cb)(struct rk29camera_gpio_res *res, int on);
-    int (*sensor_af_cb)(struct rk29camera_gpio_res *res, int on);
-};
-
-typedef struct rk29_camera_sensor_cb {
-    int (*sensor_cb)(void *arg);
-    int (*scale_crop_cb)(struct work_struct *work);
-}rk29_camera_sensor_cb_s;
-
-#endif /* _RK_CAMERA_H */
-
-- 
2.35.3

